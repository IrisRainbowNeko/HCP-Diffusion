_base_:
  - cfgs/workflow/text2img.yaml

dtype: fp16
amp: fp16
bs: 2
seed: 42

resize:
  # image to image
  - _target_: hcpdiff.workflow.LatentResizeAction

highres_diffusion:
  # only part of timesteps
  - _target_: hcpdiff.workflow.ExecAction
    prog: |-
      states['timesteps'] = states['timesteps'][int(30*(1-0.6)):]
      states['start_timestep'] = states['timesteps'][:1]
  - _target_: hcpdiff.workflow.MakeLatentAction
    width: 1024
    height: 1024
  - _target_: hcpdiff.workflow.LoopAction
    loop_value:
      timesteps: t
    actions:
      - _target_: hcpdiff.workflow.DiffusionStepAction
        guidance_scale: 7.0

actions:
  - build_model
  - optimize_model
  - text
  - config_diffusion
  - diffusion
  ### highres fix ###
  - resize
  - config_diffusion
  - highres_diffusion
  ### highres fix ###
  - decode